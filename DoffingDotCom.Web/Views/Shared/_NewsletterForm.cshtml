@using DoffingDotCom.Web.Services


<div class="subscribe-form-block">
    <p>Sign up for my newsletter!</p>
    @using (Html.BeginForm(null, null, FormMethod.Post, new { @class = "newsletter-form" }))
    {
        <label for="email">Email</label>
        <input type="text" name="email" id="emailInput" placeholder="Please provide your email" />

        <button type="button" id="subscribe">Subscribe</button>
    }
</div>

<script>
    @functions{

        public string TokenHeaderValue()
        {
            string cookieToken, formToken;
            AntiForgery.GetTokens(null, out cookieToken, out formToken);
            return cookieToken + ":" + formToken;
        }

    }

    (function () {
        var $button = $('#subscribe'),
            $emailForm = $('#emailInput'),
            $formBlock = $('.subscribe-form-block');


        $button.click(function (evt) {
            evt.preventDefault();

            var data = {
                email: $emailForm.val()
            };

            $.ajax("api/contact/newsletter", {
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),

                dataType: 'json',
                headers: {
                    '@RequestForgeryService.TokenHeader': '@RequestForgeryService.GetTokenHeaderValue()'
                },
                success: onSuccess,
                error: onError
            });
        });

        function onSuccess(resp) {
            //confirm success!
            console.log(resp);
            $emailForm.val('');
        }

        function onError(err, xhr, some) {
            //what do we do here????
            console.log(err, xhr, some);
        }
    })()
</script>